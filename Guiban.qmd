---
title: "Guiban"
author: "Marilys Guiban"
format: html
---

```{r}
library(here)
library(dplyr)
library(tidyr)
library(vroom)

here::i_am("eval-grades.Rproj")
```

### Question 1

```{r}
courses <- vroom(here("data", "courses.csv"))
```

### Question 2

```{r}
# Load the necessary library for table formatting
library(knitr) 
library(dplyr)

# 1. Prepare the data: Sort and rename columns
courses |>
  arrange(course) |> 
  rename(
    "course name" = course,
    "identifier" = course_id,
    "module" = module,
    "Number of Exams" = nb_grades
  ) |>
  kable(
    caption = "Course Descriptions and Exam Counts",
    align = "l"
  )
```

### Question 3

```{r}
names(students)
```

```{r}
students <- vroom(here("data", "students.csv"))
students |>
  mutate(
    id = as.integer(id),          # recommended in the instructions
    group = as.factor(group),     # recommended in the instructions
    birth_date = as.Date(birth_date),  # must be Date
    sex = as.factor(sex)               # must be factor
  )
```

```{r}
str(students)

```

### Question 4

```{r}
gradenaive <- read.csv(here("data", "grades.csv"))


grades <- read_delim(
  here("data", "grades.csv"),
  delim = ":",    # Correct separator
  na = "$",       # Convert $ to NA
  col_types = cols(
    id = col_integer(),
    course_id = col_integer(),
    grade = col_double()
  )
)

# Preview the first rows (optional but recommended)
head(grades)
```

### Question 5

```{r}
students_factor <- read_delim(here("data", "students.csv"),
  col_types = cols(
     sex = col_factor()
  )
)
```

```{r}
str(students_factor)
```

Now that sex is well-encoded let's compute the graphical representation :

```{r}
library(ggplot2)
students <- students |> 
  mutate(group = as.factor(group))

ggplot(students, aes(x = group)) +
  geom_bar(fill = "#1f77b4") +           # bar plot
  labs(
    title = "Number of Students per Group",
    x = "Group",
    y = "Number of Students"
  ) +
  theme_minimal(base_size = 14) 
```

### Question 6

```{r}
ggplot(students, aes(x = group, fill = sex)) +
  geom_bar() +
  labs(
    title = "Gender Balance per Group",
    x = "Group",
    y = "Number of Students",
    fill = "Sex"
  ) +
  theme_minimal(base_size = 14)
```

### Question 7

```{r}
students <- students |>
  mutate(age = as.integer(floor((Sys.Date() - birth_date)/365.25)))

ggplot(students, aes(x = age)) +
  geom_histogram(binwidth = 1, fill = "#1f77b4", color = "black") +
  labs(
    title = "Distribution of Student Ages",
    x = "Age (years)",
    y = "Number of Students"
  ) +
  theme_minimal(base_size = 14)
```

### Question 8

```{r}
students <- students |>
  mutate(age_years = as.numeric(Sys.Date() - birth_date) / 365.25)

median_age_group <- students |>
  group_by(group) |>
  summarise(median_age = round(median(age_years), 1), .groups = "drop")

median_age_group |> kable(
  caption = "Median Age of Students per Group (in years, with decimals)",
  col.names = c("Group", "Median Age (years)")
)
```

### Question 9

```{r}
students |>
  group_by(group) |>
  filter(age == max(age)) |>
  select(ID = id, Sex = sex, Age = age) |>  # rename columns directly
  ungroup() |>
  arrange(desc(Age)) |> 
  print()
```

## Simple grade analysis

### Question 10

Before doing these questions, it seems more relevant to join the two files together :

```{r}
grades_students <- grades |>
  filter(!is.na(grade)) |>             # remove missing grades
  inner_join(students, by = "id") 
```

```{r}
n_grades <- grades_students |>
  summarise(total = n()) |>
  pull(total)

# In order to print the sentence we do : 
cat("The data set contains", n_grades, "grades.\n")
```

### Question 11

```{r}
# Compute average grade per group for Cryptography
avg_crypto <- grades_students |>
  left_join(courses, by = "course_id") |>      # get course names
  filter(course == "Cryptography and Codebreaking") |>
  group_by(group) |>
  summarise(avg_grade = mean(grade, na.rm = TRUE), .groups = "drop")

ggplot(avg_crypto, aes(x = as.factor(group), y = avg_grade, fill = as.factor(group))) +
  geom_col() + 
  labs(
    title = "Average Grade in Cryptography and Codebreaking by Group",
    x = "Group",
    y = "Average Grade",
    fill = "Group"
  ) +
  theme_minimal(base_size = 14) +
  theme(legend.position = "none")

```

### Question 12

In this question we compare the distribution of all the grades per module :

```{r}
library(dplyr)
library(ggplot2)

grades_modules <- grades_students |>
  left_join(courses, by = "course_id") |>
  filter(!is.na(grade))  # garder toutes les notes

# Boxplot avec facet_wrap pour comparer Module 1 et Module 2
ggplot(grades_modules, aes(x = as.factor(group), y = grade, fill = as.factor(group))) +
  geom_boxplot() +
  scale_y_continuous(limits = c(0, 20)) +  # axe 0-20 pour toutes les notes
  labs(
    title = "Grade Distribution by Module and Group",
    x = "Group",
    y = "Grade",
    fill = "Group"
  ) +
  facet_wrap(~ module, nrow = 1) +  # un facet par module, côte à côte
  theme_minimal(base_size = 14) +
  theme(legend.position = "none")

```

### Question 13

```{r}
grades_per_student <- grades_students |>
  filter(!is.na(grade)) |>              # remove missing grades
  group_by(id, group, sex) |>
  summarise(n_grades = n(), .groups = "drop")

# Show an extract of the resulting data frame (first 10 rows)
head(grades_per_student, 10)

# Compute min, max, mean, median
grades_summary <- grades_per_student |>
  summarise(
    min = min(n_grades),
    max = max(n_grades),
    mean = mean(n_grades),
    median = median(n_grades)
  ) |> 
  knitr::kable()
```

### Question 14

```{r}
grades_by_sex <- grades_per_student |>
  group_by(sex) |>
  summarise(total_grades = sum(n_grades), .groups = "drop")

# Bar plot
ggplot(grades_by_sex, aes(x = sex, y = total_grades, fill = sex)) +
  geom_col() +
  labs(
    title = "Total Number of Grades by Sex",
    x = "Sex",
    y = "Total Grades",
    fill = "Sex"
  ) +
  theme_minimal(base_size = 14) +
  theme(legend.position = "none")
```

### Question 15

```{r}
alchemy_grades <- grades_students |>
  left_join(courses, by = "course_id") |>           # join to get course names
  filter(course == "Alchemy and Chemical Engineering") |>  # keep only that course
  group_by(id, group) |>                            # keep student info
  summarise(n_grades = n(), .groups = "drop")      # count grades

# Show a small extract for Quarto rendering
alchemy_grades |> 
  select(id, group, n_grades) |>
  slice_head(n=10) |> 
  knitr::kable()
```

### Question 16

```{r}
grades_distribution <- alchemy_grades |>
  group_by(n_grades) |>
  summarise(num_students = n(), .groups = "drop") 

ggplot(grades_distribution, aes(x = as.factor(n_grades), y = num_students)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Distribution of Number of Grades per Student in Alchemy and Chemical Engineering",
    x = "Number of Grades",
    y = "Number of Students"
  ) +
  theme_minimal(base_size = 14)
```

### Question 17

```{r}
ggplot(alchemy_grades, aes(x = as.factor(group), y = n_grades, fill = as.factor(group))) +
  geom_boxplot() +
  labs(
    title = "Number of Grades in Alchemy and Chemical Engineering per Group",
    x = "Group",
    y = "Number of Grades",
    fill = "Group"
  ) +
  theme_minimal(base_size = 14) +
  theme(legend.position = "none")
```

Here it seems that the lowest grade differ but the mean does not seem do differ between each group.

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

## Running Code

When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r}
1 + 1
```

You can add options to executable code like this

```{r}
#| echo: false
2 * 2
```

The `echo: false` option disables the printing of code (only output is displayed).
